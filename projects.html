<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projects | The Property Brief</title>

<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">

  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="projects.css" />
</head>

<body>
  <header class="topbar">
  <div class="brand">
    <img src="assets/Logo TPB White.png" alt="The Property Brief" class="logo" />
  </div>

  <!-- Hamburger button (mobile only) -->
  <button class="hamburger" id="hamburgerProjects" type="button" aria-label="Toggle menu">
    <span></span>
    <span></span>
    <span></span>
  </button>

  <nav class="nav" id="mainNavProjects" aria-label="Main navigation">
    <a href="index.html#home">Home</a>
    <a href="index.html#latest">News</a>
    <a href="index.html#strategies">Strategies</a>
    <a href="index.html#about">About</a>
    <a href="index.html#search">Search</a>
    <a href="projects.html" class="active" aria-current="page">Listings</a>
  </nav>

  <div class="headerActions">
    <button class="headerBtn" id="openAdModalBtn" type="button">Post Free Ad</button>
    <button class="shareIconBtn" id="sharePageBtn" type="button" aria-label="Share this page">‚Üó</button>
  </div>
</header>

  <main>
    <!-- HERO (Admin slider) -->
    <section id="projectsHero" class="hero-section" aria-label="Hero">
      <div class="hero-slider">
        <div id="admin-slider-container"></div>

        <button class="slider-arrow prev" type="button" onclick="changeSlide(-1)" aria-label="Previous slide">‚Äπ</button>
        <button class="slider-arrow next" type="button" onclick="changeSlide(1)" aria-label="Next slide">‚Ä∫</button>

        <div class="slider-dots" id="slider-dots" aria-label="Slider dots"></div>
      </div>
    </section>

    <!-- LISTINGS + FILTERS -->
    <section class="listings-section" aria-label="Listings">
      <div class="container">
        <div class="filter-bar">
          <select id="filter-listing-type" aria-label="Filter listing type">
            <option value="">All Listings</option>
            <option value="For Rent">For Rent</option>
            <option value="Sub Sale">Sub Sale</option>
            <option value="New Launch">New Launch</option>
          </select>

          <select id="filter-state" aria-label="Filter state" onchange="updateDistrictDropdown()">
            <option value="">All States</option>
          </select>

          <select id="filter-district" aria-label="Filter district" onchange="updateAreaDropdown()">
            <option value="">All Districts</option>
          </select>

          <select id="filter-area" aria-label="Filter area">
            <option value="">All Areas</option>
          </select>

          <select id="filter-category" aria-label="Filter property type">
            <option value="">Category</option>
            <option value="High Rise Residential">High Rise Residential</option>
            <option value="Landed Residential">Landed Residential</option>
            <option value="Commercial">Commercial</option>
            <option value="Land">Land</option>
          </select>

          <input type="number" id="filter-price-min" placeholder="Min Price (RM)" aria-label="Min price" />
          <input type="number" id="filter-price-max" placeholder="Max Price (RM)" aria-label="Max price" />

          <!-- Important: explicit type="button" avoids accidental form submits -->
          <button id="btn-search" type="button" onclick="applyFilters()">Search</button>
          <button id="btn-reset" type="button" onclick="clearFilters()">Reset</button>
        </div>

        <h2>Latest Property Listings</h2>
        <p id="property-count" style="margin: 8px 0 0; color:#666;"></p>

        <div id="listings-container" class="property-grid">
          <p>Loading the latest properties...</p>
        </div>
      </div>
    </section>
  </main>

  <!-- PROPERTY DETAILS MODAL -->
  <div class="modalOverlay" id="propertyModal" aria-hidden="true"></div>

  <!-- POST FREE AD MODAL -->
  <div class="modalOverlay" id="adModal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-label="Post Free Ad">
      <div class="modalHeader">
        <h2>Post Free Ad</h2>
        <button class="modalClose" id="closeAdModalBtn" type="button" aria-label="Close">‚úï</button>
      </div>

      <form
        name="project-submit"
        method="POST"
        data-netlify="true"
        action="/projects-thank-you.html"
        enctype="multipart/form-data"
      >
        <!-- Netlify needs this hidden field to match the form name -->
        <input type="hidden" name="form-name" value="project-submit" />
        <input type="hidden" name="propertyType" id="propertyType" />

        <!-- SECTION 1 (visible first) -->
        <div id="form-section-1">
          <h3>Section 1 - Basic Info</h3>

          <label>
            For
            <select name="listingType" id="listingType" required>
              <option value="">Select</option>
              <option value="For Rent">For Rent</option>
              <option value="Sub Sale">Sub Sale</option>
              <option value="New Launch">New Launch</option>
            </select>
          </label>

          <label>
            Category
            <select name="category" id="category" required>
              <option value="">Select</option>
              <option value="High Rise Residential">High Rise Residential</option>
              <option value="Landed Residential">Landed Residential</option>
              <option value="Commercial">Commercial</option>
              <option value="Land">Land</option>
            </select>
          </label>

          <label>
            Seller Type
            <select name="sellerType" id="sellerType" required>
              <option value="">Select</option>
              <option value="Private Seller">Private Seller</option>
              <option value="Agent">Agent</option>
            </select>
          </label>

          <button type="button" id="form-next-btn">Next</button>
        </div>

        <!-- SECTION 2 (hidden initially) -->
        <div id="form-section-2" style="display:none;">
          <h3>Section 2 - Property Details</h3>

          <label>
            Photos (up to 5 images)
            <input name="photo1" type="file" accept="image/*" />
            <input name="photo2" type="file" accept="image/*" />
            <input name="photo3" type="file" accept="image/*" />
            <input name="photo4" type="file" accept="image/*" />
            <input name="photo5" type="file" accept="image/*" />
          </label>

          <label>
            Ad Title
            <input name="adTitle" type="text" required />
          </label>

          <label>
            Tenure
            <select name="tenure" required>
              <option value="">Select</option>
              <option value="Freehold">Freehold</option>
              <option value="Leasehold">Leasehold</option>
            </select>
          </label>

          <!-- HIGH RISE RESIDENTIAL -->
          <div id="fields-high-rise-residential" style="display:none;">
            <label>
              Property Type
              <select name="highRiseType">
                <option value="">Select</option>
                <option value="Apartment">Apartment</option>
                <option value="Condominium">Condominium</option>
              </select>
            </label>

            <label>
              Title
              <select name="landTitle">
                <option value="">Select</option>
                <option value="Bumi">Bumi</option>
                <option value="Non-bumi">Non-bumi</option>
              </select>
            </label>

            <label>
              Bedrooms
              <select name="bedrooms">
                <option value="">Select</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </label>

            <label>
              Bathrooms
              <select name="bathrooms">
                <option value="">Select</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </label>

            <label>
              Built Up (sq.ft.)
              <input name="builtUpSqft" type="number" placeholder="e.g., 1200" />
            </label>

            <label>
              Parking Lot
              <select name="parking">
                <option value="">Select</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </label>

            <label>
              No. Of Storey
              <input name="storeyCount" type="number" min="1" max="100" placeholder="e.g., 15" />
            </label>
          </div>

          <!-- LANDED RESIDENTIAL - FIXED: Combined Link House -->
          <div id="fields-landed-residential" style="display:none;">
            <label>
              Property Type
              <select name="landedType">
                <option value="">Select</option>
                <option value="Bungalow">Bungalow</option>
                <option value="Semi Detached">Semi Detached</option>
                <option value="Cluster">Cluster</option>
                <option value="Link House">Link House</option>
                <option value="Townhouse">Townhouse</option>
              </select>
            </label>

            <label>
              Land Title
              <select name="landTitle">
                <option value="">Select</option>
                <option value="Bumi">Bumi</option>
                <option value="Non-bumi">Non-bumi</option>
                <option value="Malay Reserved">Malay Reserved</option>
              </select>
            </label>

            <label>
              Bedrooms
              <select name="bedrooms">
                <option value="">Select</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>
            </label>

            <label>
              Bathrooms
              <select name="bathrooms">
                <option value="">Select</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>
            </label>

            <label>
              Built Up (sq.ft.)
              <input name="builtUpSqft" type="number" placeholder="e.g., 2400" />
            </label>

            <label>
              Parking Lot
              <select name="parking">
                <option value="">Select</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>
            </label>

            <label>
              No. Of Storey
              <input name="storeyCount" type="number" min="1" max="10" placeholder="e.g., 2" />
            </label>
          </div>

          <!-- COMMERCIAL -->
          <div id="fields-commercial" style="display:none;">
            <label>
              Property Type
              <select name="commercialType">
                <option value="">Select</option>
                <option value="Shop Lot">Shop Lot</option>
                <option value="Office">Office</option>
                <option value="Factory">Factory</option>
              </select>
            </label>

            <label>
              Land Title
              <select name="landTitle">
                <option value="">Select</option>
                <option value="Bumi">Bumi</option>
                <option value="Non-bumi">Non-bumi</option>
                <option value="Malay Reserved">Malay Reserved</option>
              </select>
            </label>

            <label>
              Built Up (sq.ft.)
              <input name="builtUpSqft" type="number" placeholder="e.g., 3000" />
            </label>

            <label>
              No. Of Storey
              <input name="storeyCount" type="number" min="1" max="50" placeholder="e.g., 3" />
            </label>
          </div>

          <!-- LAND -->
          <div id="fields-land" style="display:none;">
            <label>
              Property Type
              <select name="landType">
                <option value="">Select</option>
                <option value="Residential">Residential</option>
                <option value="Industrial">Industrial</option>
                <option value="Agricultural">Agricultural</option>
                <option value="Commercial">Commercial</option>
                <option value="Mix-Development">Mix-Development</option>
                <option value="Others">Others</option>
              </select>
            </label>

            <label>
              Land Title
              <select name="landTitle">
                <option value="">Select</option>
                <option value="Bumi">Bumi</option>
                <option value="Non-bumi">Non-bumi</option>
                <option value="Malay Reserved">Malay Reserved</option>
              </select>
            </label>

            <label>
              Land Size (acres / sq.ft)
              <input name="landSize" type="text" placeholder="e.g., 5 acres or 50000 sq.ft" />
            </label>
          </div>

          <label>
            Description
            <textarea name="description" rows="5" required></textarea>
          </label>

          <!-- LOCATION SECTION - STYLED TO MATCH THEME -->
          <div class="location-section">
            <h4>üìç Property Location</h4>
            
            <button type="button" id="open-map-btn" class="map-btn">
              üó∫Ô∏è Pin Location on Map (Auto-fills below)
            </button>

            <div id="selected-location-display" class="location-confirmed">
              <p class="location-confirmed-label">‚úì Location Pinned:</p>
              <p id="location-text" class="location-confirmed-text"></p>
            </div>

            <label>
              State
              <select name="state" id="ad-state" required>
                <option value="">Select state</option>
              </select>
            </label>

            <label>
              District
              <select name="district" id="ad-district" required disabled>
                <option value="">Select district</option>
              </select>
            </label>

            <label>
              Area / Township
              <select name="area" id="ad-area" required disabled>
                <option value="">Select area</option>
              </select>
            </label>

            <label id="ad-area-custom-wrapper" style="display:none;">
              Or type your location
              <input type="text" name="areaCustom" id="ad-area-custom" placeholder="e.g., Taman Kinrara, Bandar Sunway" />
            </label>
          </div>

          <!-- Hidden fields for precise location data -->
          <input type="hidden" name="latitude" id="ad-latitude" />
          <input type="hidden" name="longitude" id="ad-longitude" />
          <input type="hidden" name="locationFull" id="ad-locationFull" />

          <label>
            Price (RM)
            <input name="priceRm" type="number" placeholder="e.g., 450000" required />
          </label>

          <label>
            Contact
            <input name="contact" type="text" placeholder="e.g., +60123456789 or email" required />
          </label>

          <div class="form-buttons">
            <button type="button" id="form-back-btn">Back</button>
            <button type="submit">Submit</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- MAP MODAL WITH SEARCH BOX (GEOCODING API) -->
  <div id="map-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10000; padding:20px;">
    <div style="background:white; border-radius:8px; max-width:900px; margin:0 auto; height:90vh; display:flex; flex-direction:column;">
      <div style="padding:16px; border-bottom:1px solid #ddd;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
          <div>
            <h3 style="margin:0;">üìç Pin Your Property Location</h3>
            <p style="margin:4px 0 0; font-size:14px; color:#666;">Type address and click Search, or click on map</p>
          </div>
          <button type="button" id="close-map-btn" style="background:none; border:none; font-size:24px; cursor:pointer;">‚úï</button>
        </div>
        
        <!-- SEARCH BOX WITH BUTTON -->
        <div style="display:flex; gap:8px;">
          <input 
            type="text" 
            id="map-search-box" 
            placeholder="üîç Type address (e.g., Bandar Sunway, Selangor, Malaysia)" 
            style="flex:1; padding:12px; border:2px solid #007bff; border-radius:4px; font-size:14px;"
          />
          <button 
            type="button" 
            id="search-location-btn" 
            style="padding:12px 20px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;"
          >
            Search
          </button>
        </div>
      </div>
      
      <div id="google-map" style="flex:1; width:100%;"></div>
      
      <div style="padding:16px; border-top:1px solid #ddd; text-align:center;">
        <button type="button" id="confirm-location-btn" style="padding:12px 32px; background:#28a745; color:white; border:none; border-radius:4px; cursor:pointer; font-size:16px; font-weight:bold;">
          ‚úì Confirm This Location
        </button>
      </div>
    </div>
  </div>

  <!-- Scripts: Load in correct order with defer -->
  <script src="CONFIG.js"></script>
  <script defer src="menu.js"></script>
  <script defer src="projects.js"></script>
  <script defer src="https://cdn.auth0.com/js/auth0-spa-js/2.5/auth0-spa-js.production.js"></script>
  <script defer src="auth.js"></script>

  <script>
  const nextBtn = document.getElementById('form-next-btn');
  const backBtn = document.getElementById('form-back-btn');
  const section1 = document.getElementById('form-section-1');
  const section2 = document.getElementById('form-section-2');
  const categorySelect = document.getElementById('category');

  // Location Elements
  const stateSelect = document.getElementById('ad-state');
  const districtSelect = document.getElementById('ad-district');
  const areaSelect = document.getElementById('ad-area');
  const customAreaWrapper = document.getElementById('ad-area-custom-wrapper');

  // 1. Navigation Logic
  nextBtn.addEventListener('click', () => {
    section1.style.display = 'none';
    section2.style.display = 'block';
    loadStates();
  });

  backBtn.addEventListener('click', () => {
    section2.style.display = 'none';
    section1.style.display = 'block';
  });

  // 2. Category Logic
  categorySelect.addEventListener('change', (e) => {
  const val = e.target.value;
  
  // Hide all property type sections
  document.getElementById('fields-high-rise-residential').style.display = 'none';
  document.getElementById('fields-landed-residential').style.display = 'none';
  document.getElementById('fields-commercial').style.display = 'none';
  document.getElementById('fields-land').style.display = 'none';
  
  // Show relevant section
  if (val === 'High Rise Residential') {
    document.getElementById('fields-high-rise-residential').style.display = 'block';
  } else if (val === 'Landed Residential') {
    document.getElementById('fields-landed-residential').style.display = 'block';
  } else if (val === 'Commercial') {
    document.getElementById('fields-commercial').style.display = 'block';
  } else if (val === 'Land') {
    document.getElementById('fields-land').style.display = 'block';
  }
});

// NEW CODE: Sync property type fields to hidden field
document.querySelectorAll('[name="highRiseType"], [name="landedType"], [name="commercialType"], [name="landType"]').forEach(select => {
  select.addEventListener('change', (e) => {
    document.getElementById('propertyType').value = e.target.value;
  });
});

  // 3. LOCATION DROPDOWN LOGIC
  
  async function loadStates() {
    try {
      const response = await fetch('/content/settings/locations/states.json');
      const data = await response.json();
      const states = data.states;
      
      stateSelect.innerHTML = '<option value="">Select state</option>';
      states.forEach(stateName => {
        stateSelect.innerHTML += `<option value="${stateName}">${stateName}</option>`;
      });
    } catch (err) {
      console.error('Error loading states:', err);
    }
  }

  stateSelect.addEventListener('change', async (e) => {
    const stateName = e.target.value;
    if (!stateName) {
      districtSelect.disabled = true;
      areaSelect.disabled = true;
      return;
    }

    try {
      districtSelect.disabled = false;
      const response = await fetch('/content/settings/locations/districts.json');
      const data = await response.json();
      const districts = data.districtsByState[stateName];
      
      districtSelect.innerHTML = '<option value="">Select district</option>';
      districts.forEach(districtName => {
        districtSelect.innerHTML += `<option value="${districtName}">${districtName}</option>`;
      });
      
      areaSelect.innerHTML = '<option value="">Select area</option>';
      areaSelect.disabled = true;
    } catch (err) {
      console.error('Error loading districts:', err);
    }
  });

  districtSelect.addEventListener('change', async (e) => {
    const districtName = e.target.value;
    const stateName = stateSelect.value.toLowerCase().replace(/\s+/g, '-');
    
    if (!districtName) {
      areaSelect.disabled = true;
      return;
    }

    try {
      areaSelect.disabled = false;
      const response = await fetch(`/content/settings/locations/areas/${stateName}.json`);
      const data = await response.json();
      
      const districtObj = data.districts.find(d => d.name === districtName);
      
      if (districtObj && districtObj.areas) {
        areaSelect.innerHTML = '<option value="">Select area</option>';
        districtObj.areas.forEach(areaObj => {
          areaSelect.innerHTML += `<option value="${areaObj.name}">${areaObj.name}</option>`;
        });
        areaSelect.innerHTML += `<option value="others">Others (Type manually)</option>`;
      } else {
        customAreaWrapper.style.display = 'block';
      }
    } catch (err) {
      console.error('Error loading areas:', err);
      customAreaWrapper.style.display = 'block';
    }
  });

  areaSelect.addEventListener('change', (e) => {
    customAreaWrapper.style.display = (e.target.value === 'others') ? 'block' : 'none';
  });

  // 4. DISABLE HIDDEN FIELDS BEFORE SUBMITTING
  const form = document.querySelector('form[name="project-submit"]');

  form.addEventListener('submit', (e) => {
    const sections = ['high-rise-residential', 'landed-residential', 'commercial', 'land'];
    
    sections.forEach(cat => {
      const container = document.getElementById(`fields-${cat}`);
      if (container && container.style.display === 'none') {
        container.querySelectorAll('input, select, textarea').forEach(field => {
          field.disabled = true;
        });
      }
    });
  });

  // ============================================
  // GOOGLE MAPS WITH GEOCODING SEARCH
  // ============================================

  let map, marker, selectedLocation, geocoder;

  document.getElementById('open-map-btn').addEventListener('click', () => {
    document.getElementById('map-modal').style.display = 'block';
    setTimeout(() => {
      if (!map) initMap();
    }, 300);
  });

  document.getElementById('close-map-btn').addEventListener('click', () => {
    document.getElementById('map-modal').style.display = 'none';
  });

  function initMap() {
    const defaultCenter = { lat: 3.139, lng: 101.6869 };
    
    map = new google.maps.Map(document.getElementById('google-map'), {
      center: defaultCenter,
      zoom: 12,
      mapTypeControl: true,
      streetViewControl: false,
    });
    
    geocoder = new google.maps.Geocoder();
    
    // Manual click on map
    map.addListener('click', (event) => {
      placeMarker(event.latLng);
    });

    // Search button click
    document.getElementById('search-location-btn').addEventListener('click', searchLocation);
    
    // Also search when Enter is pressed
    document.getElementById('map-search-box').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        searchLocation();
      }
    });
  }

  function searchLocation() {
    const searchBox = document.getElementById('map-search-box');
    const address = searchBox.value.trim();
    
    if (!address) {
      alert('Please type an address!');
      return;
    }

    // Use Geocoder to find location
    geocoder.geocode({ 
      address: address,
      componentRestrictions: { country: 'MY' } // Restrict to Malaysia
    }, (results, status) => {
      if (status === 'OK' && results[0]) {
        const location = results[0].geometry.location;
        
        // Center map on found location
        map.setCenter(location);
        map.setZoom(15);
        
        // Place marker
        placeMarker(location);
      } else {
        alert('Location not found! Try: "Bandar Sunway, Selangor" or "KLCC, Kuala Lumpur"');
      }
    });
  }

  function placeMarker(location) {
    if (marker) marker.setMap(null);
    
    marker = new google.maps.Marker({
      position: location,
      map: map,
      draggable: true,
      animation: google.maps.Animation.DROP
    });
    
    selectedLocation = {
      lat: location.lat(),
      lng: location.lng()
    };
    
    geocoder.geocode({ location: location }, (results, status) => {
      if (status === 'OK' && results[0]) {
        parseAddress(results[0]);
      }
    });
    
    marker.addListener('dragend', () => {
      const newPos = marker.getPosition();
      selectedLocation = {
        lat: newPos.lat(),
        lng: newPos.lng()
      };
      
      geocoder.geocode({ location: newPos }, (results, status) => {
        if (status === 'OK' && results[0]) {
          parseAddress(results[0]);
        }
      });
    });
  }

  function parseAddress(result) {
    const components = result.address_components;
    let state = '', district = '', area = '';
    
    components.forEach(comp => {
      if (comp.types.includes('administrative_area_level_1')) {
        state = comp.long_name;
      }
      if (comp.types.includes('administrative_area_level_2')) {
        district = comp.long_name;
      }
      if (comp.types.includes('locality') || comp.types.includes('sublocality') || comp.types.includes('sublocality_level_1')) {
        area = comp.long_name;
      }
    });
    
    selectedLocation.state = state;
    selectedLocation.district = district;
    selectedLocation.area = area;
    selectedLocation.fullAddress = result.formatted_address;
  }

  document.getElementById('confirm-location-btn').addEventListener('click', async () => {
    if (!selectedLocation) {
      alert('Please pin a location on the map first!');
      return;
    }
    
    document.getElementById('ad-latitude').value = selectedLocation.lat || '';
    document.getElementById('ad-longitude').value = selectedLocation.lng || '';
    document.getElementById('ad-locationFull').value = selectedLocation.fullAddress || '';
    
    document.getElementById('selected-location-display').style.display = 'block';
    document.getElementById('location-text').textContent = selectedLocation.fullAddress;
    
    if (selectedLocation.state) {
      if (stateSelect.options.length <= 1) {
        await loadStates();
      }
      
      for (let i = 0; i < stateSelect.options.length; i++) {
        if (stateSelect.options[i].value === selectedLocation.state) {
          stateSelect.selectedIndex = i;
          stateSelect.dispatchEvent(new Event('change'));
          break;
        }
      }
      
      if (selectedLocation.district) {
        setTimeout(() => {
          for (let i = 0; i < districtSelect.options.length; i++) {
            if (districtSelect.options[i].value === selectedLocation.district) {
              districtSelect.selectedIndex = i;
              districtSelect.dispatchEvent(new Event('change'));
              break;
            }
          }
          
          if (selectedLocation.area) {
            setTimeout(() => {
              let foundArea = false;
              for (let i = 0; i < areaSelect.options.length; i++) {
                if (areaSelect.options[i].value === selectedLocation.area) {
                  areaSelect.selectedIndex = i;
                  foundArea = true;
                  break;
                }
              }
              
              if (!foundArea) {
                areaSelect.value = 'others';
                areaSelect.dispatchEvent(new Event('change'));
                document.getElementById('ad-area-custom').value = selectedLocation.area;
              }
            }, 500);
          }
        }, 500);
      }
    }
    
    document.getElementById('map-modal').style.display = 'none';
  });

  </script>

  <style>
  /* LOCATION SECTION STYLING - MATCHES DARK THEME */
  .location-section {
    padding: 20px;
    margin: 20px 0;
    border-radius: 12px;
    border: 1px solid rgba(249,209,0,0.20);
    background: rgba(249,209,0,0.04);
  }

  .location-section h4 {
    margin: 0 0 16px 0;
    font-size: 16px;
    font-weight: 700;
    color: #f9d100;
    letter-spacing: 0.3px;
  }

  .map-btn {
    width: 100%;
    padding: 12px;
    margin-bottom: 16px;
    background: rgba(249,209,0,0.15);
    border: 1px solid rgba(249,209,0,0.35);
    border-radius: 12px;
    color: #f9d100;
    font-size: 14px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .map-btn:hover {
    background: rgba(249,209,0,0.25);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(249,209,0,0.2);
  }

  .location-confirmed {
    display: none;
    padding: 12px;
    margin-bottom: 16px;
    background: rgba(40, 167, 69, 0.15);
    border: 1px solid rgba(40, 167, 69, 0.35);
    border-radius: 8px;
  }

  .location-confirmed-label {
    margin: 0;
    font-weight: 700;
    font-size: 13px;
    color: #4ade80;
  }

  .location-confirmed-text {
    margin: 6px 0 0;
    font-size: 13px;
    color: #a1a1aa;
    line-height: 1.5;
  }
  </style>

  <!-- Google Maps API - NO PLACES LIBRARY NEEDED -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCtHBA74KW3ZS8WE8OKUr6tWy2MHFHxGw8&callback=initMap"></script>

</body>
</html>